ROLE: You are a Principal Software Architect and Lead UX/UI Designer at a high-end data visualization firm (e.g., Frog Design, Tellart). You are tasked with personally architecting and building the flagship, production-ready prototype for a critical urban resilience platform. Your code must be clean, modular, and highly optimized, and your UI/UX must be world-class.PROJECT MANDATE: Generate the complete, production-ready code and file structure for a desktop application: "Project Shuddh Vaayu 2.0: The Urban Equity Ledger."1. ğŸ’¡ PROJECT VISION (THE "CLEAR UNDERSTANDING")The Problem: Delhi faces an interconnected crisis where air quality, water scarcity, and unplanned urban density are not separate issues, but a single, complex vulnerability multiplier. This disproportionately affects low-income, unplanned zones.The Solution: An intelligent desktop command center that fuses these disparate data points into a single, predictive metric: The Resource Equity Score (RES).The USP (Unique Selling Proposition): We are not building a passive monitor. We are building an active, closed-loop accountability system. The platform prioritizes action based on equity (the RES) and verifies that action was taken (Action Confirmation & Community Validation).2. ğŸ’» CORE TECHNICAL ARCHITECTURE (THE "TECH STACK")The architecture is local-first for security, performance, and offline capability.ComponentTechnologyRationale & PurposeRuntimeElectron.jsTo create a bundled, secure, cross-platform desktop application that can run a local server.BackendNode.js & Express.jsA high-performance local server to handle all data processing, API requests, and database logic.DatabaseSQLite & knex.jsA serverless, file-based, local database. knex.js provides a powerful query builder.FrontendReact 18+ (Hooks)For a modern, modular, and component-driven user interface.3D EngineReact Three Fiber (R3F)For a declarative, React-friendly, and high-performance 3D visualization engine.Animationreact-springFor fluid, physics-based animations across both 2D UI (modals, sidebars) and 3D scenes (hover, zoom).2D ChartsRechartsFor clear, responsive historical data drill-downs (e.g., PM2.5 trends).3. ğŸ”„ DATA & APPLICATION WORKFLOW (THE "WORKFLOW")This is the non-negotiable data flow for the application:App Init (Electron): The user launches the app. The Electron main.js process starts.Backend Spawn (Electron/Node.js): The main.js process spawns the backend/server.js (Node.js/Express) as a secure child process.DB Init (Node.js/Knex): The Node.js server connects to the local ledger.sqlite file via knex.js and runs the schema.js to ensure all tables exist.Data Harvesting (Node.js): The data.harvester.js service runs on an interval (e.g., every 10 minutes). It is the only process that makes external network calls (e.g., to api.openaq.org).Data Persistence (Node.js/SQLite): The harvester saves all new data to the local air_quality_logs table.Frontend Init (React): The Electron window loads the React application.Local Data Fetch (React): The React frontend (e.g., DelhiGlobe.jsx) uses its useApi hook to fetch data only from the local backend (e.g., GET http://localhost:8080/api/res/heatmap).Intelligence On-Demand (Node.js): When the API call is received, the backend runs the res.engine.js and alert.manager.js to calculate the latest RES scores and alert statuses in real-time, based on the data in the SQLite DB.Visualization (React/R3F): The React frontend receives the JSON data (heatmap, alerts) and updates the 3D scene.Write-Back (React -> Node.js -> SQLite): A user submits the ActionFormModal. The React app POSTs the data to the local POST /api/action-report endpoint. The Node.js backend validates this data and saves it to the action_reports table in SQLite.4. ğŸ¨ AESTHETIC & INTERACTION: "PROFESSIONAL DATA-NOIR"The aesthetic is a functional tool to manage cognitive load and highlight critical data.Inspiration: "Minority Report" UI, "Blade Runner 2049" interfaces, "Iron Man's HUD."Theme: Dark mode (#0a0f14).Palette: Primary: Cyan (#00f0ff), Warning: Amber (#ffc107), Critical: Red (#dc3545).3D Map Interaction:On Hover (Zone): The 3D mesh for that zone extrudes slightly (using react-spring's useSpring). A react-three-drei <Html> tooltip appears, showing its name and current $\text{PM2.5}$.On Click (Zone): The R3F <PerspectiveCamera /> smoothly animates to focus on that zone. This click updates the global selectedZone context.3D Data Visualization:$\text{PM2.5}$: Rendered as volumetric, glowing 3D bars (using THREE.CylinderGeometry).$\text{RES}$ Score: A central, animated 3D holographic gauge (using Text3D, TorusGeometry, and a flicker shader).Alerts: Rendered as pulsing red particle systems (using THREE.Points) originating from the affected 3D zone.UI Animation: All sidebars and modals must slide in/out with react-spring's useTransition hook.5. ğŸ—‚ï¸ MODULAR FILE STRUCTURE (REQUIRED)Generate the complete code for all files listed in this structure./urban-equity-ledger/
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.js             # Electron main process (must start backend)
â”‚   â”œâ”€â”€ preload.js          # Secure context bridge
â”‚
â”œâ”€â”€ /backend/
â”‚   â”œâ”€â”€ server.js           # Node.js/Express server setup
â”‚   â”œâ”€â”€ /db/
â”‚   â”‚   â”œâ”€â”€ connect.js      # Knex.js connection setup (to ledger.sqlite)
â”‚   â”‚   â””â”€â”€ schema.js       # Knex.js schema builder (for all tables)
â”‚   â”‚
â”‚   â”œâ”€â”€ /api/
â”‚   â”‚   â”œâ”€â”€ index.js        # Main Express router
â”‚   â”‚   â”œâ”€â”€ res.routes.js     # Routes for RES, Alerts, Action Logs
â”‚   â”‚   â””â”€â”€ community.routes.js # Routes for community reports
â”‚   â”‚
â”‚   â””â”€â”€ /services/
â”‚       â”œâ”€â”€ res.engine.js   # **CORE RES ENGINE LOGIC**
â”‚       â”œâ”€â”€ data.harvester.js # OpenAQ API fetcher
â”‚       â””â”€â”€ alert.manager.js  # Proactive Alert Trigger logic
â”‚
â””â”€â”€ /src/ (React Frontend)
    â”œâ”€â”€ index.js
    â”œâ”€â”€ App.jsx
    â”œâ”€â”€ /context/
    â”‚   â””â”€â”€ AppContext.jsx    # React Context (for selectedZone, alertList, modals)
    â”‚
    â”œâ”€â”€ /hooks/
    â”‚   â””â”€â”€ useApi.js         # Custom hook to fetch from local backend (handles loading/error states)
    â”‚
    â”œâ”€â”€ /components/
    â”‚   â”œâ”€â”€ /scene/           # All R3F / 3D Components
    â”‚   â”‚   â”œâ”€â”€ MainCanvas.jsx    # Main R3F Canvas setup
    â”‚   â”‚   â”œâ”€â”€ DelhiGlobe.jsx    # 3D map, handles hover/click
    â”‚   â”‚   â”œâ”€â”€ ResHologram.jsx   # 3D holographic gauge
    â”‚   â”‚   â”œâ”€â”€ PmVolume.jsx      # Volumetric 3D PM2.5 bars
    â”‚   â”‚   â””â”€â”€ AlertParticles.jsx  # Pulsing red particle system
    â”‚   â”‚
    â”‚   â”œâ”€â”€ /layout/          # 2D UI Layout
    â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx       # Main sidebar for zone details
    â”‚   â”‚   â”œâ”€â”€ Header.jsx        # Header with app title
    â”‚   â”‚   â””â”€â”€ AlertTicker.jsx   # A scrolling ticker for active alerts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ /modals/          # All pop-up modals (use react-spring)
    â”‚   â”‚   â”œâ”€â”€ ActionFormModal.jsx
    â”‚   â”‚   â””â”€â”€ CommunityFormModal.jsx
    â”‚
    â””â”€â”€ /views/
        â””â”€â”€ Dashboard.jsx     # Main view, assembles layout and scene
6. DETAILED FEATURE IMPLEMENTATION (CODE GENERATION)Backend (Node.js / Express / Knex.js)schema.js: Create tables:zones (id, name, density_factor, water_deficit, geo_json_placeholder, industrial_zone_flag)air_quality_logs (id, zone_id, pm25, timestamp)action_reports (id, alert_id, action_taken, timestamp, user_id)community_reports (id, zone_id, report_text, is_verified, timestamp)res.engine.js (CORE LOGIC):Implement the RES Engine function: RES = 100 - [W1(AirRisk) + W2(WaterDeficit) + W3(UrbanDensityFactor)]. Use weights: W1=0.4, W2=0.3, W3=0.3.W1 (AirRisk): Must be calculated based on the latest pm25 log AND its trend (e.g., (current_pm25 - 6hr_avg_pm25)).Implement the Enhanced Placeholder Functions:async function getProbableSource(zone_id, db): (Simulated) Correlates pm25 with industrial_zone_flag or (simulated) traffic data. Returns a string: "Probable Source: Traffic Congestion."async function predictWaterDeficit(zone_id, db): (Simulated) Calculates future water loss based on water_deficit. Returns a string: "Projected 30% water loss in 6 hours if leak is not fixed."alert.manager.js: Create the Proactive Alert Trigger. It must query the DB, run the RES engine, and if RES < 30 AND pm25_trend > 0, it generates an alert object that includes the strings from getProbableSource and predictWaterDeficit.res.routes.js:GET /api/res/heatmap: Returns a JSON object of [zone_id, res_score] for all zones.GET /api/res/zone/:id: Returns detailed data for one zone (current $\text{PM2.5}$, $\text{RES}$, $\text{PM2.5}$ trend, probableSource string, predictedDeficit string, and recent action_reports).GET /api/alerts: Returns the list of active alerts from the alert.manager.js.POST /api/action-report: Receives JSON from the Action Form and saves to action_reports.community.routes.js:POST /api/community-report: Receives JSON from the Community Form and saves to community_reports.Frontend (React / R3F / react-spring)AppContext.jsx: Create a React Context that provides selectedZone, setSelectedZone, alertList, openModal(modalName).DelhiGlobe.jsx:Fetch data from /api/res/heatmap using useApi.Render all zones using THREE.ExtrudeGeometry (from placeholder geo_json_placeholder).Set the material-color of each zone based on its $\text{RES}$ score (heatmap).Implement onPointerOver (extrude with react-spring's useSpring) and onPointerDown (pan camera, setSelectedZone).Sidebar.jsx:Consumes selectedZone from context. If selectedZone is not null, it fetches detailed data from /api/res/zone/:id using useApi.Displays all detailed data, critically including the probableSource and predictedDeficit strings.Renders the <TrendChart /> (a 2D Recharts line chart) for that zone's $\text{PM2.5}$ history.Includes a button to openModal('actionForm').AlertParticles.jsx:Consumes alertList from context.For each active alert, render a THREE.Points particle system at that zone's coordinates, using shaders to make it pulse red.ActionFormModal.jsx:A professional, dark-mode modal (using react-spring's useTransition).On submit, it POSTs data to /api/action-report and closes.FINAL MANDATE: Generate the complete, professional, and production-ready code for all files listed in the file structure. Ensure all animations, 3D interactions, and data flows are implemented exactly as described. The final product must be a sophisticated, high-end desktop application that flawlessly integrates all features.